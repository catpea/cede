<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>⚔️</text></svg>" />
    <title>cede: State Kernel Demo</title>
    <style>
      *, *::before, *::after { box-sizing: border-box; } * { margin: 0; }
      html { color-scheme: light dark; line-height: 1.15; -webkit-text-size-adjust: 100%; -moz-tab-size: 4; tab-size: 4; padding: 3vh 5vw; }
    </style>
  </head>
  <body>
    <h1 id="helloWorldElement">Hello, world!</h1>
    <input type="text" id="helloWorldInput" />
    <input type="text" id="firstNameInput" />
    <input type="text" id="lastNameInput" />
    <h1 id="inputPreviewElement">Hello, world!</h1>
    <h1>Test Results</h1>
    <pre id="output"></pre>

    <script type="module">
      import { test, describe, it, waitForCompletion } from "./modules/cletus/cletus.js";

      import { Tree } from "./Tree.js";

      describe("Tree operations", () => {
        const tree = new Tree("kernel-test", false);

        // tree.load({
        //   "my-app": {
        //     "user": {
        //       "profile.obj": {
        //         "id": "d8460a47-fd71-499a-9c75-a379d8349378"
        //       }
        //     },
        //     "workspace": {
        //       "gradient.arr": {
        //         "id": "fa0e44ff-454c-4317-bd09-884cfebdf989"
        //       }
        //     }
        //   }
        // });
        // tree.dump();

        // it("should create profile.obj", () => {
          const expected = { password:"hunter2" };
          const password = tree.mk("/my-app/user/profile.obj", expected);
          const actual = password.signal.value;

          console.assert(actual == expected);
          console.log(actual, expected)
        // });

        // it("should create profile.obj/password", () => {
        //   const expected = "hunter2";
        //   const password = tree.mk("/my-app/user/profile.obj/password", expected);
        //   const actual = password.value;
        //   console.assert(actual == expected);
        // });

        // it("should create gradient.arr/0/color", () => {
        //   const expected = "#ff0000";
        //   const gradient = tree.mk("/my-app/workspace/gradient.arr/0/color", expected);
        //   const actual = gradient.value;
        //   console.assert(actual == expected);
        // });

        // it("should create gradient.arr/0/percent", () => {
        //   const expected = 0;
        //   const percent = tree.mk("/my-app/workspace/gradient.arr/0/percent", expected);
        //   const actual = percent.value;
        //   console.assert(actual == expected);
        // });

        it("should return a serializable JSON", { todo: false }, () => {
          // console.log( tree.save() );
          // const result = tree.load();
          console.log("FLATTENED");
          const flat = tree.flatten();
          console.table(flat);
          // console.log(JSON.stringify(flat, 0, 2));
          // flat.forEach(o=>tree.mk(o))
        });
      });

      // Wait for tests to complete and display results
      const results = await waitForCompletion();
      document.getElementById("output").textContent = `Passed: ${results.summary.passed}\n` + `Failed: ${results.summary.failed}\n` + `Total: ${results.summary.total}`;
    </script>
  </body>
</html>
