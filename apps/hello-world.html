<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Hello World - Lifecycle Orchestration</title>
    <style>
      html {
        color-scheme: light dark;
        font-family: system-ui, sans-serif;
      }

      body {
        max-width: 800px;
        margin: 2rem auto;
        padding: 0 1rem;
      }

      h1 {
        color: #0066ff;
        margin-bottom: 2rem;
      }

      #directoryListing {
        display: grid;
        gap: 1rem;
      }

      .hello-item {
        padding: 1rem;
        background: #f0f0f0;
        border-radius: 8px;
        border-left: 4px solid #0066ff;
      }

      .hello-text {
        font-size: 1.25rem;
        font-weight: 500;
        margin: 0;
      }

      @media (prefers-color-scheme: dark) {
        .hello-item {
          background: #2c2b32;
          border-left-color: #4d9fff;
        }
      }
    </style>
  </head>
  <body id="apps">
    <h1>üåç Hello World in 10 Languages</h1>

    <div id="helloWorldApp">
      <div id="directoryListing"></div>
    </div>

    <!-- Templates -->
    <template id="helloWorldTemplate">
      <!-- Container for repeater -->
    </template>

    <template id="repeaterTemplate">
      <div class="hello-item">
        <p class="hello-text" data-name="hello">Hello World</p>
      </div>
    </template>

    <!-- XML App Declaration -->
    <xml-app id="helloApp" src="hello-app.xml"></xml-app>

    <script type="module">
      // Import your lifecycle classes and XmlApp
      import { ApplicationLifecycle, TemplateLifecycle, RepeaterLifecycle } from './index.js';
      import { XmlApp } from './XmlApp.js';

      // Register lifecycle components
      XmlApp.registerLifecycle('Application', ApplicationLifecycle);
      XmlApp.registerLifecycle('Template', TemplateLifecycle);
      XmlApp.registerLifecycle('Repeater', RepeaterLifecycle);

      // Wait for the XML app to load and initialize
      const helloAppElement = document.getElementById('helloApp');

      // Use MutationObserver or a brief delay to ensure orchestration is complete
      await new Promise(resolve => setTimeout(resolve, 100));

      // Access the root lifecycle and populate data
      const helloApp = helloAppElement.root;

      helloApp.tree.write("/helloApp/hello.arr", [
        { hello: 'Hello World' },        // English
        { hello: 'Hola Mundo' },         // Spanish
        { hello: 'Bonjour le Monde' },   // French
        { hello: 'Hallo Welt' },         // German
        { hello: 'Ciao Mondo' },         // Italian
        { hello: 'Witam ≈öwiat' },        // Polish
        { hello: '„Åì„Çì„Å´„Å°„ÅØ‰∏ñÁïå' },        // Japanese
        { hello: '‰Ω†Â•Ω‰∏ñÁïå' },             // Chinese
        { hello: '–ü—Ä–∏–≤–µ—Ç –º–∏—Ä' },         // Russian
        { hello: 'ŸÖÿ±ÿ≠ÿ®ÿß ÿ®ÿßŸÑÿπÿßŸÑŸÖ' }        // Arabic
      ]);

      // Demonstrate reactivity after 2 seconds
      setTimeout(() => {
        console.log('‚ú® Updating first greeting...');
        helloApp.tree.write("/helloApp/hello.arr/0", { hello: 'üëã Hello Universe!' });
      }, 2000);
    </script>
  </body>
</html>
